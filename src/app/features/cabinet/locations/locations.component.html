<h2 class="text-2xl font-bold text-coffee-900 mb-6">Locations</h2>

<!-- Existing locations first -->
<div *ngIf="locations$ | async as locations" class="mb-8">
  <div *ngIf="locations.length">
    <ul class="space-y-3">
      <li *ngFor="let loc of locations" class="p-4 border rounded-lg bg-white/80 shadow-sm">
        <div class="flex items-center gap-3">
          <span class="inline-flex w-7 h-7 items-center justify-center rounded-full bg-coffee-900 text-white text-xs">#</span>

          <!-- Read mode -->
          <div class="flex-1" *ngIf="editingId !== loc.id">
            <div class="text-coffee-900">{{ loc.address }}</div>
          </div>

          <!-- Edit mode -->
          <div class="flex-1" *ngIf="editingId === loc.id" [formGroup]="editForm">
            <input type="text" formControlName="address"
                   class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-coffee-300"
                   placeholder="Enter address" />
          </div>

          <!-- Actions -->
          <div class="flex items-center gap-2">
            <!-- Edit button (pencil) -->
            <button *ngIf="editingId !== loc.id" (click)="startEdit(loc)"
                    class="p-2 rounded-md hover:bg-coffee-100 text-coffee-900"
                    title="Edit">
              ‚úé
            </button>

            <!-- Delete button (trash) -->
            <button *ngIf="editingId !== loc.id" (click)="deleteLocation(loc)"
                    class="p-2 rounded-md hover:bg-red-50 text-red-600"
                    [disabled]="loading"
                    title="Delete">
              üóëÔ∏è
            </button>

            <!-- Save/Cancel when editing -->
            <ng-container *ngIf="editingId === loc.id">
              <button (click)="saveEdit()"
                      class="px-3 py-1.5 rounded-full bg-coffee-900 text-white hover:bg-coffee-800 disabled:opacity-60"
                      [disabled]="editForm.invalid || loading">
                {{ loading ? 'Saving...' : 'Save' }}
              </button>
              <button (click)="cancelEdit()"
                      class="px-3 py-1.5 rounded-full border border-coffee-300 text-coffee-900 hover:bg-coffee-50"
                      [disabled]="loading">
                Cancel
              </button>
            </ng-container>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>

<!-- Add new location below the list -->
<div [formGroup]="form" class="mt-6 p-4 border rounded-lg bg-white/70">
  <h3 class="text-sm font-semibold text-coffee-800 mb-3">Add new location</h3>
  <div class="mb-4">
    <label class="block text-sm text-coffee-700 mb-1">Location</label>
    <input type="text" formControlName="address" placeholder="Georgia, Tbilisi"
           class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-coffee-300" />
    <div class="text-xs text-red-500 mt-1" *ngIf="submitted && form.controls['address'].invalid">Enter a location</div>
  </div>

  <button (click)="addLocation()"
          class="inline-flex items-center gap-2 px-5 py-2 rounded-full bg-coffee-900 text-white hover:bg-coffee-800 disabled:opacity-60"
          [disabled]="loading">
    <span class="text-lg leading-none">Ôºã</span>
    <span>{{ loading ? 'Adding...' : 'Add location' }}</span>
  </button>

  <div class="mt-3">
    <span class="text-red-600" *ngIf="error">{{ error }}</span>
    <span class="text-green-700" *ngIf="success">{{ success }}</span>
  </div>
</div>
